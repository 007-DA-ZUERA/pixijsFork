{"version":3,"file":"triangleInstance.mjs","sources":["../../../../../src/scene/graphics/shared/utils/triangleInstance.ts"],"sourcesContent":["// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport Triangle from 'triangle-wasm';\nimport wasmBase64 from '../../gl/triangle.wasm.base64';\n\nlet triangleInstance: any = null;\nlet triangleInitialized = false;\n\nfunction base64ToArrayBuffer(base64: string): ArrayBuffer\n{\n    const binary = atob(base64);\n    const bytes = new Uint8Array(binary.length);\n\n    for (let i = 0; i < binary.length; i++)\n    {\n        bytes[i] = binary.charCodeAt(i);\n    }\n\n    return bytes.buffer;\n}\n\nfunction getWasmBlobUrl(): string\n{\n    const arrayBuffer = base64ToArrayBuffer(wasmBase64);\n    const blob = new Blob([arrayBuffer], { type: 'application/wasm' });\n\n    return URL.createObjectURL(blob);\n}\n\nexport function getTriangleInstance()\n{\n    if (!triangleInitialized)\n    {\n        console.warn('Triangle-wasm not yet initialized. Call initTriangleWasm() during app startup.');\n    }\n\n    return triangleInstance;\n}\n\nexport async function initTriangleWasm()\n{\n    if (!triangleInstance)\n    {\n        console.log('Initializing Triangle-wasm...');\n        const wasmUrl = getWasmBlobUrl();\n\n        // NOTE: current triangle-wasm init may resolve with no value.\n        // So don't expect a Module return value here â€” await it, then use the imported Triangle.\n        await Triangle.init(wasmUrl);\n\n        // The exported API lives on the imported object, so use that as the instance.\n        triangleInstance = Triangle;\n        triangleInitialized = true;\n\n        // Revoke blob url now that the wasm has been fetched/instantiated\n        URL.revokeObjectURL(wasmUrl);\n        \n        console.log('Triangle-wasm initialized successfully');\n    }\n\n    return triangleInstance;\n}\n"],"names":[],"mappings":";;;;AAKA,IAAI,gBAAwB,GAAA,IAAA,CAAA;AAC5B,IAAI,mBAAsB,GAAA,KAAA,CAAA;AAE1B,SAAS,oBAAoB,MAC7B,EAAA;AACI,EAAM,MAAA,MAAA,GAAS,KAAK,MAAM,CAAA,CAAA;AAC1B,EAAA,MAAM,KAAQ,GAAA,IAAI,UAAW,CAAA,MAAA,CAAO,MAAM,CAAA,CAAA;AAE1C,EAAA,KAAA,IAAS,CAAI,GAAA,CAAA,EAAG,CAAI,GAAA,MAAA,CAAO,QAAQ,CACnC,EAAA,EAAA;AACI,IAAA,KAAA,CAAM,CAAC,CAAA,GAAI,MAAO,CAAA,UAAA,CAAW,CAAC,CAAA,CAAA;AAAA,GAClC;AAEA,EAAA,OAAO,KAAM,CAAA,MAAA,CAAA;AACjB,CAAA;AAEA,SAAS,cACT,GAAA;AACI,EAAM,MAAA,WAAA,GAAc,oBAAoB,UAAU,CAAA,CAAA;AAClD,EAAM,MAAA,IAAA,GAAO,IAAI,IAAK,CAAA,CAAC,WAAW,CAAG,EAAA,EAAE,IAAM,EAAA,kBAAA,EAAoB,CAAA,CAAA;AAEjE,EAAO,OAAA,GAAA,CAAI,gBAAgB,IAAI,CAAA,CAAA;AACnC,CAAA;AAEO,SAAS,mBAChB,GAAA;AACI,EAAA,IAAI,CAAC,mBACL,EAAA;AACI,IAAA,OAAA,CAAQ,KAAK,gFAAgF,CAAA,CAAA;AAAA,GACjG;AAEA,EAAO,OAAA,gBAAA,CAAA;AACX,CAAA;AAEA,eAAsB,gBACtB,GAAA;AACI,EAAA,IAAI,CAAC,gBACL,EAAA;AACI,IAAA,OAAA,CAAQ,IAAI,+BAA+B,CAAA,CAAA;AAC3C,IAAA,MAAM,UAAU,cAAe,EAAA,CAAA;AAI/B,IAAM,MAAA,QAAA,CAAS,KAAK,OAAO,CAAA,CAAA;AAG3B,IAAmB,gBAAA,GAAA,QAAA,CAAA;AACnB,IAAsB,mBAAA,GAAA,IAAA,CAAA;AAGtB,IAAA,GAAA,CAAI,gBAAgB,OAAO,CAAA,CAAA;AAE3B,IAAA,OAAA,CAAQ,IAAI,wCAAwC,CAAA,CAAA;AAAA,GACxD;AAEA,EAAO,OAAA,gBAAA,CAAA;AACX;;;;"}